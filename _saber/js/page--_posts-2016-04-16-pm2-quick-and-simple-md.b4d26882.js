(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{26:function(t,e,a){"use strict";a.r(e);var s=a(0),i=function(t){var e,a,s,i=(s=void 0,(e={}).type=a="post",e.internal=s,e.contentType="markdown",e.slug="pm2-quick-and-simple",e.content=s,e.createdAt=new Date(14607648e5),e.updatedAt=new Date(1585946691429),e.title="PM2: Quick and Simple",e.date="2016-04-16",e.layout=a,e.markdownHeadings=[{text:"Install",slug:"install",level:2},{text:"Run",slug:"run",level:2},{text:"Cluster mode",slug:"cluster-mode",level:2},{text:"Monitoring",slug:"monitoring",level:2},{text:"Logging",slug:"logging",level:2},{text:"Conclusion",slug:"conclusion",level:2}],e.excerpt='<p><a href="https://pm2.keymetrics.io/">PM2</a> is a process manager popular for managing node.js applications. It has built-in cluster, load-balancing and auto-restart support.</p>\n',e.permalink="/posts/pm2-quick-and-simple.html",e.assets={},e.attributes=e,e),o=t.options.beforeCreate||[];t.options.beforeCreate=[function(){this.$page=i}].concat(o);["layout","transition"].forEach((function(e){var a=t.options.PageComponent;a&&(t.options[e]=a[e]),void 0===t.options[e]&&(t.options[e]=i[e])})),i.slug&&(t.options.name="page-wrapper-"+i.slug.replace(/[^0-9a-z\-]/gi,"-"))},o=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("layout-manager",[a("p",[a("saber-link",{attrs:{to:"https://pm2.keymetrics.io/"}},[t._v("PM2")]),t._v(" is a process manager popular for managing node.js applications. It has built-in cluster, load-balancing and auto-restart support.")],1),t._v(" "),a("h2",{attrs:{id:"install"}},[t._v("Install")]),t._v(" "),a("p",[t._v("Globally install pm2 module.")]),t._v(" "),a("div",{pre:!0,attrs:{class:"saber-highlight","data-lang":"sh"}},[a("pre",{pre:!0,attrs:{class:"saber-highlight-code language-sh"}},[a("code",{pre:!0,attrs:{class:"language-sh"}},[t._v("npm install pm2 -g")])])]),a("h2",{attrs:{id:"run"}},[t._v("Run")]),t._v(" "),a("p",[t._v("Start, Daemonize and auto restart application.")]),t._v(" "),a("div",{pre:!0,attrs:{class:"saber-highlight","data-lang":"sh"}},[a("pre",{pre:!0,attrs:{class:"saber-highlight-code language-sh"}},[a("code",{pre:!0,attrs:{class:"language-sh"}},[t._v("pm2 start <entry_point>.js")])])]),a("p",[a("img",{attrs:{src:"https://miro.medium.com/max/1400/1*gcfVc4oVfHGexzQvPQIs9Q.gif",alt:""}})]),t._v(" "),a("p",[t._v("Above we have started our application in "),a("em",[t._v("fork_mode")]),t._v(" (1 instance) with an "),a("em",[t._v("application name")]),t._v(" and "),a("em",[t._v("process id")]),t._v(" used as reference to interact with our application with PM2. There is also a restart count, uptime and currently used memory. The restart count is useful in the case our node application hits an exception, fails fast, and dies so that PM2 can restart the instance and continue.")]),t._v(" "),a("h2",{attrs:{id:"cluster-mode"}},[t._v("Cluster mode")]),t._v(" "),a("p",[t._v("PM2 comes with built-in cluster support that is smart enough to spin up one node process per CPU core using the following:")]),t._v(" "),a("div",{pre:!0,attrs:{class:"saber-highlight","data-lang":"sh"}},[a("pre",{pre:!0,attrs:{class:"saber-highlight-code language-sh"}},[a("code",{pre:!0,attrs:{class:"language-sh"}},[t._v("pm2 start app.js -i max")])])]),a("p",[a("img",{attrs:{src:"https://miro.medium.com/max/1400/1*5eE_lREH_TyPxSYWA6ryNA.gif",alt:""}})]),t._v(" "),a("p",[t._v("Using the -i flag and value max we can take advantage of PM2 dynamically spinning up one worker per core of our CPU. Here we see 8 instances of our application with a unique id and process id. We also get the benefit of PM2’s built-in load-balancer that will "),a("saber-link",{attrs:{to:"https://en.wikipedia.org/wiki/Round-robin_scheduling"}},[t._v("round robin")]),t._v(" requests. Remember all instances will be restarted by PM2 upon failures. More details on cluster mode "),a("saber-link",{attrs:{to:"https://keymetrics.io/2015/03/26/pm2-clustering-made-easy/"}},[t._v("here")]),t._v(".")],1),t._v(" "),a("h2",{attrs:{id:"monitoring"}},[t._v("Monitoring")]),t._v(" "),a("div",{pre:!0,attrs:{class:"saber-highlight","data-lang":"sh"}},[a("pre",{pre:!0,attrs:{class:"saber-highlight-code language-sh"}},[a("code",{pre:!0,attrs:{class:"language-sh"}},[t._v("pm2 monit")])])]),a("p",[a("img",{attrs:{src:"https://miro.medium.com/max/1400/1*esuua163oY-fCc2bB4S6jg.png",alt:""}})]),t._v(" "),a("p",[t._v("To monitor our application we simply give the pm2 monit command that will show us the current CPU and memory usage per process. PM2 also has a "),a("saber-link",{attrs:{to:"http://pm2.keymetrics.io/docs/usage/monitoring/#programmatic"}},[t._v("max_memory_restart")]),t._v(" value on startup that can be applied to watch for memory usage and restart the process once it hits a certain threshold.")],1),t._v(" "),a("h2",{attrs:{id:"logging"}},[t._v("Logging")]),t._v(" "),a("p",[t._v("Managing logs with PM2 is not only easy, but one of it’s best features. With simple configuration you can rotate, merge, separate via file and timestamp and even compress or send notifications for your logs. Managing some of these "),a("saber-link",{attrs:{to:"http://pm2.keymetrics.io/docs/usage/log-management/"}},[t._v("features")]),t._v(" is available via JSON or other formatted configurations like so:")],1),t._v(" "),a("div",{pre:!0,attrs:{class:"saber-highlight","data-lang":""}},[a("pre",{pre:!0,attrs:{class:"saber-highlight-code language-text"}},[a("code",{pre:!0,attrs:{class:"language-text"}},[t._v("{\n “script” : “echo.js”,\n “error_file” : “err.log”,\n “out_file” : “out.log”,\n “merge_logs” : true,\n “log_date_format” : “YYYY-MM-DD HH:mm Z”\n}")])])]),a("h2",{attrs:{id:"conclusion"}},[t._v("Conclusion")]),t._v(" "),a("p",[t._v("This is just a quick and simple overview of what PM2 can do for managing your node application. There is a full-blown dashboard in "),a("saber-link",{attrs:{to:"https://app.keymetrics.io/"}},[t._v("keymetrics.io")]),t._v(", a module community for extending it’s capabilities, and amazing "),a("saber-link",{attrs:{to:"http://pm2.keymetrics.io/"}},[t._v("documentation")]),t._v(". It’s worth a test run!")],1)])}),[],!1,null,null,null);"function"==typeof i&&i(o);e.default=o.exports}}]);