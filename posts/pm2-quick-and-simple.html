<!DOCTYPE html><html data-saber-ssr><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="ie=edge" /><meta data-saber-head="ssr" name="generator" content="Saber v0.11.5"><meta data-saber-head="ssr" name="description" content="Heads down"><meta data-saber-head="ssr" name="description" content="PM2 is a process manager popular for managing node.js applications. It has built-in cluster, load-balancing and auto-restart support.
"> <title>PM2: Quick and Simple - Shaun Warman</title> <link data-saber-head="ssr" rel="alternate" title="Shaun Warman - Feed" type="application/json" href="null"><style data-vue-ssr-id="60268c6a:0">blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,ol,p,pre,ul{margin:0;padding:0}body{font:400 16px/1.5 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;color:#111;background-color:#fdfdfd;-webkit-text-size-adjust:100%;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1;font-feature-settings:"kern" 1;font-kerning:normal;display:flex;min-height:100vh;flex-direction:column}blockquote,dl,figure,h1,h2,h3,h4,h5,h6,ol,p,pre,ul{margin-bottom:15px}main{display:block}img{max-width:100%;vertical-align:middle}figure>img{display:block}figcaption{font-size:14px}ol,ul{margin-left:30px}li>ol,li>ul{margin-bottom:0}h1,h2,h3,h4,h5,h6{font-weight:400}a{color:#2a7ae2;text-decoration:none}a:visited{color:#1756a9}a:hover{color:#111;text-decoration:underline}.social-media-list a:hover{text-decoration:none}.social-media-list a:hover .username{text-decoration:underline}blockquote{color:#828282;border-left:4px solid #e8e8e8;padding-left:15px;font-size:18px;letter-spacing:-1px;font-style:italic}blockquote>:last-child{margin-bottom:0}code,pre{font-size:15px;border:1px solid #e8e8e8;border-radius:3px;background-color:#eef}code{padding:1px 5px}pre{padding:8px 12px;overflow-x:auto}pre>code{border:0;padding-right:0;padding-left:0}.wrapper{max-width:770px;margin-right:auto;margin-left:auto;padding-right:15px;padding-left:15px}@media screen and (min-width:800px){.wrapper{max-width:740px;padding-right:30px;padding-left:30px}}.footer-col-wrapper:after,.wrapper:after{content:"";display:table;clear:both}.orange{color:#f66a0a}.grey{color:#828282}.svg-icon{width:16px;height:16px;display:inline-block;fill:currentColor;padding:5px 3px 2px 5px;vertical-align:text-bottom}table{margin-bottom:30px;width:100%;text-align:left;color:#3f3f3f;border-collapse:collapse;border:1px solid #e8e8e8}table tr:nth-child(2n){background-color:#f7f7f7}table td,table th{padding:10px 15px}table th{background-color:#f0f0f0;border:1px solid #dedede;border-bottom-color:#c9c9c9}table td{border:1px solid #e8e8e8}.site-header{border-top:5px solid #424242;border-bottom:1px solid #e8e8e8;min-height:55.95px;line-height:54px;position:relative}.site-title{font-size:26px;font-weight:300;letter-spacing:-1px;margin-bottom:0;float:left}@media screen and (max-width:600px){.site-title{padding-right:45px}}.site-title,.site-title:visited{color:#424242}.site-nav{position:absolute;top:9px;right:15px;background-color:#fdfdfd;border:1px solid #e8e8e8;border-radius:5px;text-align:right}.site-nav .nav-trigger{display:none}.site-nav .menu-icon{float:right;width:36px;height:26px;line-height:0;padding-top:10px;text-align:center}.site-nav .menu-icon>svg path{fill:#424242}.site-nav label[for=nav-trigger]{display:block;float:right;width:36px;height:36px;z-index:2;cursor:pointer}.site-nav input~.trigger{clear:both;display:none}.site-nav input:checked~.trigger{display:block;padding-bottom:5px}.site-nav .page-link{color:#111;line-height:1.5;display:block;padding:5px 10px;margin-left:20px}.site-nav .page-link:not(:last-child){margin-right:0}@media screen and (min-width:600px){.site-nav{position:static;float:right;border:none;background-color:inherit}.site-nav .menu-icon,.site-nav label[for=nav-trigger]{display:none}.site-nav input~.trigger{display:block}.site-nav .page-link{display:inline;padding:0;margin-left:auto}.site-nav .page-link:not(:last-child){margin-right:20px}}.pagination{margin-bottom:25px;font-size:.875rem}.pagination .next-link,.pagination .prev-link{border:1px solid #e8e8e8;padding:5px 10px;color:#111}.site-footer{border-top:1px solid #e8e8e8;padding:30px 0}.footer-heading{font-size:18px;margin-bottom:15px}.contact-list,.social-media-list{list-style:none;margin-left:0}.footer-col-wrapper{font-size:15px;color:#828282;margin-left:-15px}.footer-col{width:-webkit-calc(100% - 15px);width:calc(100% - 15px);margin-bottom:15px;padding-left:15px}.footer-col-1,.footer-col-2{width:-webkit-calc(50% - 15px);width:calc(50% - 15px)}.footer-col-3{width:-webkit-calc(100% - 15px);width:calc(100% - 15px)}@media screen and (min-width:800px){.footer-col-1{width:-webkit-calc(35% - 15px);width:calc(35% - 15px)}.footer-col-2{width:-webkit-calc(20% - 15px);width:calc(20% - 15px)}.footer-col-3{width:-webkit-calc(45% - 15px);width:calc(45% - 15px)}}@media screen and (min-width:600px){.footer-col{float:left}}.page-content{padding:30px 0;flex:1 0 auto}.page-heading{font-size:32px}.post-list-heading{font-size:28px}.post-list{margin-left:0;list-style:none}.post-list>li{margin-bottom:30px}.post-meta{font-size:14px;color:#828282}.post-link{display:block;font-size:24px}.post-header{margin-bottom:30px}.post-content h1,.post-title{font-size:42px;letter-spacing:-1px;line-height:1}@media screen and (min-width:800px){.post-content h1,.post-title{font-size:42px}}.post-content{margin-bottom:30px}.post-content h2{font-size:28px}@media screen and (min-width:800px){.post-content h2{font-size:32px}}.post-content h3{font-size:22px}@media screen and (min-width:800px){.post-content h3{font-size:26px}}.post-content h4{font-size:18px}@media screen and (min-width:800px){.post-content h4{font-size:20px}}.social-media-list{display:table;margin:0 auto}.social-media-list li{float:left;margin:0 5px}.social-media-list li:first-of-type{margin-left:0}.social-media-list li:last-of-type{margin-right:0}.social-media-list li a{display:block;padding:7.5px;border:1px solid #e8e8e8}.social-media-list li:hover .svg-icon{fill:currentColor}.one-half{width:-webkit-calc(50% - 15px);width:calc(50% - 15px)}</style>  </head><body><div id="_saber" data-server-rendered="true"><div><header class="site-header"><div class="wrapper"><a href="/" rel="author" class="site-title router-link-active">Shaun Warman</a> <nav class="site-nav"><input type="checkbox" id="nav-trigger" class="nav-trigger"> <label for="nav-trigger"><span class="menu-icon"><svg viewBox="0 0 18 15" width="18px" height="15px"><path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path></svg></span></label> <div class="trigger"><a href="/" class="page-link router-link-active">Home</a><a href="/about.html" class="page-link">About</a></div></nav></div></header> <main aria-label="Content" class="page-content"><div class="wrapper"><article itemscope="itemscope" itemtype="http://schema.org/BlogPosting" class="post h-entry"><header class="post-header"><h1 itemprop="name headline" class="post-title p-name">PM2: Quick and Simple</h1> <p class="post-meta"><time datetime="Fri Apr 15 2016 19:00:00 GMT-0500 (Central Daylight Time)" itemprop="datePublished" class="dt-published">2016-04-15</time></p></header> <div itemprop="articleBody" class="post-content e-content"><p><a rel="noopener noreferrer" target="_blank" href="https://pm2.keymetrics.io/">PM2</a> is a process manager popular for managing node.js applications. It has built-in cluster, load-balancing and auto-restart support.</p> <h2 id="install">Install</h2> <p>Globally install pm2 module.</p> <div class="saber-highlight" data-lang="sh"><pre class="saber-highlight-code language-sh"><code class="language-sh">npm install pm2 -g</code></pre></div><h2 id="run">Run</h2> <p>Start, Daemonize and auto restart application.</p> <div class="saber-highlight" data-lang="sh"><pre class="saber-highlight-code language-sh"><code class="language-sh">pm2 start &lt;entry_point&gt;.js</code></pre></div><p><img src="https://miro.medium.com/max/1400/1*gcfVc4oVfHGexzQvPQIs9Q.gif" alt=""></p> <p>Above we have started our application in <em>fork_mode</em> (1 instance) with an <em>application name</em> and <em>process id</em> used as reference to interact with our application with PM2. There is also a restart count, uptime and currently used memory. The restart count is useful in the case our node application hits an exception, fails fast, and dies so that PM2 can restart the instance and continue.</p> <h2 id="cluster-mode">Cluster mode</h2> <p>PM2 comes with built-in cluster support that is smart enough to spin up one node process per CPU core using the following:</p> <div class="saber-highlight" data-lang="sh"><pre class="saber-highlight-code language-sh"><code class="language-sh">pm2 start app.js -i max</code></pre></div><p><img src="https://miro.medium.com/max/1400/1*5eE_lREH_TyPxSYWA6ryNA.gif" alt=""></p> <p>Using the -i flag and value max we can take advantage of PM2 dynamically spinning up one worker per core of our CPU. Here we see 8 instances of our application with a unique id and process id. We also get the benefit of PM2’s built-in load-balancer that will <a rel="noopener noreferrer" target="_blank" href="https://en.wikipedia.org/wiki/Round-robin_scheduling">round robin</a> requests. Remember all instances will be restarted by PM2 upon failures. More details on cluster mode <a rel="noopener noreferrer" target="_blank" href="https://keymetrics.io/2015/03/26/pm2-clustering-made-easy/">here</a>.</p> <h2 id="monitoring">Monitoring</h2> <div class="saber-highlight" data-lang="sh"><pre class="saber-highlight-code language-sh"><code class="language-sh">pm2 monit</code></pre></div><p><img src="https://miro.medium.com/max/1400/1*esuua163oY-fCc2bB4S6jg.png" alt=""></p> <p>To monitor our application we simply give the pm2 monit command that will show us the current CPU and memory usage per process. PM2 also has a <a rel="noopener noreferrer" target="_blank" href="http://pm2.keymetrics.io/docs/usage/monitoring/#programmatic">max_memory_restart</a> value on startup that can be applied to watch for memory usage and restart the process once it hits a certain threshold.</p> <h2 id="logging">Logging</h2> <p>Managing logs with PM2 is not only easy, but one of it’s best features. With simple configuration you can rotate, merge, separate via file and timestamp and even compress or send notifications for your logs. Managing some of these <a rel="noopener noreferrer" target="_blank" href="http://pm2.keymetrics.io/docs/usage/log-management/">features</a> is available via JSON or other formatted configurations like so:</p> <div class="saber-highlight" data-lang=""><pre class="saber-highlight-code language-text"><code class="language-text">{
 “script” : “echo.js”,
 “error_file” : “err.log”,
 “out_file” : “out.log”,
 “merge_logs” : true,
 “log_date_format” : “YYYY-MM-DD HH:mm Z”
}</code></pre></div><h2 id="conclusion">Conclusion</h2> <p>This is just a quick and simple overview of what PM2 can do for managing your node application. There is a full-blown dashboard in <a rel="noopener noreferrer" target="_blank" href="https://app.keymetrics.io/">keymetrics.io</a>, a module community for extending it’s capabilities, and amazing <a rel="noopener noreferrer" target="_blank" href="http://pm2.keymetrics.io/">documentation</a>. It’s worth a test run!</p></div> <!----> <a href="/posts/pm2-quick-and-simple.html" hidden="hidden" class="u-url router-link-exact-active router-link-active"></a></article></div></main> <footer class="site-footer h-card"><div class="wrapper"><div class="footer-col-wrapper"><div class="footer-col one-half"><h2 class="footer-heading">Shaun Warman</h2> <ul class="contact-list"><li class="p-name">Shaun Warman</li> <li><a href="mailto:shaunwarman1@gmail.com" class="u-email">shaunwarman1@gmail.com</a></li></ul></div> <div class="footer-col one-half"><p>Heads down</p></div> <div class="social-links"><ul class="social-media-list"><!----> <!----> <!----> <li><a title="shaunwarman" rel="noopener noreferrer" target="_blank" href="https://github.com/shaunwarman"><svg class="svg-icon grey"><use xlink:href="/_saber/images/minima-social-icons.198a7e12.svg#github"></use></svg></a></li> <!----> <li><a title="shaunwarman" rel="noopener noreferrer" target="_blank" href="https://www.linkedin.com/in/shaunwarman"><svg class="svg-icon grey"><use xlink:href="/_saber/images/minima-social-icons.198a7e12.svg#linkedin"></use></svg></a></li> <!----> <!----> <!----> <!----> <!----> <!----> <!----></ul></div></div></div></footer></div></div><script src="/_saber/js/client.eb8685cc.js" defer></script><script src="/_saber/js/page--_posts-2016-04-16-pm2-quick-and-simple-md.b4d26882.js" defer></script></body></html>
